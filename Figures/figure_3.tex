% \documentclass[
%    tikz,
%    %border=1pt
% ]{standalone}

\documentclass{article}

\usepackage{verbatim}
\usepackage{amssymb}
\usepackage{amsmath}

\usepackage{tikz}

%\usepackage{tikz-cd}
\usepackage{pgfplots}
\usepackage[utf8]{inputenc}
\usepackage[upright]{fourier}
\usetikzlibrary{arrows,automata,positioning,matrix,cd,babel,matrix,arrows,decorations.pathmorphing,intersections}
\usetikzlibrary{intersections}

\usepackage[many]{tcolorbox}

\usepackage{graphicx,subcaption}




\pgfplotsset{compat=1.12}

\usepackage{tikz}
\usetikzlibrary{arrows,positioning,calc}
\usepackage{tikz}
\usepackage{cancel}
\usepackage{color}
\usetikzlibrary{shapes.geometric, arrows}



 \input{figures_macros.tex}


\pgfplotsset{
    every axis plot post/.style={
        line join=round
    },
    every axis/.append style={font=\large},
    every tick label/.append style={font=\large}
}

\pgfplotsset{yticklabel style={text width=1.5em,align=right}}


\usepackage{pgfplotstable}
\usepackage{booktabs}

\begin{document}

\thispagestyle{empty}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% FIGURE 2 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\begin{figure}


    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% FIGURE 2 A %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\hspace{-2.5cm}
\begin{tikzpicture}[every plot/.append style={very thick}]
\node[draw=none, fill=none] at (-1,4.8) {\Large A};
\node[draw=none, fill=none] at (2.85,4.8) {\large $E_{ext}=1.5$ nS};
%\node[draw=none, fill=none] at (2.05,3.4) {\large $\sigma=0.2$};
\begin{axis}
       [
         name=figA,
         axis line style = { draw = none },
         width=0.6\linewidth,
         height=0.5\linewidth,
         xtick           = {0, 3}         ,
         ytick           = {0, 3}         ,
         tick pos        = left           ,
         xlabel={$-$ pop. output (nS)},
         ylabel = {$+$  pop. output (nS)},
         xmin=-0.2,xmax=3.8,
         ymin=-0.2,ymax=3.8
       ]


\addplot [
quiver={u=\thisrowno{2},v=\thisrowno{3}, scale arrows=0.5}, 
gray, ->, >=stealth, mark options={scale=0.2}
] table [x index=0, y index=1, col sep=comma, mark=circle]{CSV/figure3_panel1_line1_ind00.csv};

\addplot [no markers, black, thick, dashed] table [x index=0, y index=1, col sep=comma, mark=circle]{CSV/figure3_panel1_line2_ind00.csv};

\addplot [no markers, black, thick, dotted] table [x index=0, y index=1, col sep=comma, mark=circle]{CSV/figure3_panel1_line3_ind00.csv};

\addplot [
    point meta=explicit,
    scatter, only marks,
    visualization depends on=\thisrowno{4}\as\metacolorind,
    scatter/@pre marker code/.code={
        \pgfplotsset{%
        mark size=(1+0.003*\pgfplotspointmetatransformed)},%
        \ifdim\metacolorind pt<1.0pt
            \def\markopts{color=red}%
        \else
            \def\markopts{color=blue}%
        \fi
        \expandafter\scope\expandafter[\markopts]
    },%
    scatter/@post marker code/.code={%
        \endscope
    },%
    ] table [x index=0, y index=1, meta index=2, col sep=comma]{CSV/figure3_panel1_line4_ind00.csv};


\end{axis}

\end{tikzpicture}
% % %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %     %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% FIGURE 1 B %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %     %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\hspace{0.5cm}
\begin{tikzpicture}[every plot/.append style={very thick}]
\node[draw=none, fill=none] at (-1,4.8) {\Large B};
\node[draw=none, fill=none] at (2.85,4.8) {\large $E_{ext}=2.0$ nS};
%\node[draw=none, fill=none] at (2.05,3.4) {\large $\sigma=0.2$};
\begin{axis}
       [
         axis line style = { draw = none },
         width=0.6\linewidth,
         height=0.5\linewidth,
         xtick           = {0, 3}         ,
         ytick           = {0, 3}         ,
         tick pos        = left           ,
         xlabel={$-$ pop. output (nS)},
         ylabel = {$+$  pop. output (nS)},
         xmin=-0.2,xmax=3.8,
         ymin=-0.2,ymax=3.8
       ]


\addplot [
quiver={u=\thisrowno{2},v=\thisrowno{3}, scale arrows=0.5}, 
gray, ->, >=stealth, mark options={scale=0.2}
] table [x index=0, y index=1, col sep=comma, mark=circle]{CSV/figure3_panel1_line1_ind06.csv};

\addplot [no markers, black, thick, dashed] table [x index=0, y index=1, col sep=comma, mark=circle]{CSV/figure3_panel1_line2_ind06.csv};

\addplot [no markers, black, thick, dotted] table [x index=0, y index=1, col sep=comma, mark=circle]{CSV/figure3_panel1_line3_ind06.csv};

\addplot [
    point meta=explicit,
    scatter, only marks,
    visualization depends on=\thisrowno{4}\as\metacolorind,
    scatter/@pre marker code/.code={
        \pgfplotsset{%
        mark size=(1+0.003*\pgfplotspointmetatransformed)},%
        \ifdim\metacolorind pt<1.0pt
            \def\markopts{color=red}%
        \else
            \def\markopts{color=blue}%
        \fi
        \expandafter\scope\expandafter[\markopts]
    },%
    scatter/@post marker code/.code={%
        \endscope
    },%
    ] table [x index=0, y index=1, meta index=2, col sep=comma]{CSV/figure3_panel1_line4_ind06.csv};


\end{axis}

\end{tikzpicture}


% % %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %     %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% FIGURE 2 C %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %     %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\vspace{0.2cm}
\hspace{-2.5cm}

\hspace{-2.5cm}
\begin{tikzpicture}[every plot/.append style={very thick}]
\node[draw=none, fill=none] at (-1,4.8) {\Large C};
\node[draw=none, fill=none] at (2.85,4.8) {\large $E_{ext}=2.5$ nS};
%\node[draw=none, fill=none] at (2.05,3.4) {\large $\sigma=0.2$};
\begin{axis}
       [
         axis line style = { draw = none },
         width=0.6\linewidth,
         height=0.5\linewidth,
         xtick           = {0, 3}         ,
         ytick           = {0, 3}         ,
         tick pos        = left           ,
         xlabel={$-$ pop. output (nS)},
         ylabel = {$+$  pop. output (nS)},
         xmin=-0.2,xmax=3.8,
         ymin=-0.2,ymax=3.8
       ]


\addplot [
quiver={u=\thisrowno{2},v=\thisrowno{3}, scale arrows=0.5}, 
gray, ->, >=stealth, mark options={scale=0.2}
] table [x index=0, y index=1, col sep=comma, mark=circle]{CSV/figure3_panel1_line1_ind12.csv};

\addplot [no markers, black, thick, dashed] table [x index=0, y index=1, col sep=comma, mark=circle]{CSV/figure3_panel1_line2_ind12.csv};

\addplot [no markers, black, thick, dotted] table [x index=0, y index=1, col sep=comma, mark=circle]{CSV/figure3_panel1_line3_ind12.csv};

\addplot [
    point meta=explicit,
    scatter, only marks,
    visualization depends on=\thisrowno{4}\as\metacolorind,
    scatter/@pre marker code/.code={
        \pgfplotsset{%
        mark size=(1+0.003*\pgfplotspointmetatransformed)},%
        \ifdim\metacolorind pt<1.0pt
            \def\markopts{color=red}%
        \else
            \def\markopts{color=blue}%
        \fi
        \expandafter\scope\expandafter[\markopts]
    },%
    scatter/@post marker code/.code={%
        \endscope
    },%
    ] table [x index=0, y index=1, meta index=2, col sep=comma]{CSV/figure3_panel1_line4_ind12.csv};


\end{axis}

\end{tikzpicture}
% % %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %     %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% FIGURE 2 D %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %     %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\hspace{0.5cm}
\begin{tikzpicture}[every plot/.append style={very thick}]
\node[draw=none, fill=none] at (-1,4.8) {\Large D};
\begin{axis}
       [
         name=figB,
         axis line style = { draw = none },
         width=0.6\linewidth,
         height=0.5\linewidth,
         xtick           = {1.5,2,2.5}         ,
         ytick           = {0, 0.5, 1, 1.5}         ,
         tick pos        = left           ,
         xlabel={$E_{ext}$ (nS)},
         ylabel = {Eigenvalues},
       ]


\addplot [no markers, black] table [x index=0, y index=1, col sep=comma, mark=circle]{CSV/figure3_panel2_line1.csv};

\addplot [no markers, black] table [x index=0, y index=2, col sep=comma, mark=circle]{CSV/figure3_panel2_line1.csv};

\addplot [no markers, thin, gray, dashed] coordinates {(1.5,1.0) (2.5,1.0)};


\end{axis}

% Manually tikz-picture arrows
\draw [->, >=latex, very thick] (5,2.0) -- (5.65,1.35);
\node [draw=none,fill=none] at (4.6, 1.6) {Unstable};
\draw [->, >=latex, very thick] (5,2.0) -- (5.65,2.65);
\node [draw=none,fill=none] at (4.6, 2.4) {Stable};



% % Inset average coordinates (tikz coordinate transformation is weird, jsut add manually)
% \begin{axis}
%        [
%          at={(0,2)},
%          hide x axis,
%          hide y axis,
%          xmin = -1, xmax=1,
%          ymin = -1, ymax=1
%        ]

% \addplot [
% quiver={u=\thisrowno{2},v=\thisrowno{3}, scale arrows=0.7}, 
% gray, ->, >=stealth, mark options={scale=0.2}
% ] table [x index=0, y index=1, col sep=comma, mark=circle]{CSV/figure3_panel2_line2.csv};

% \end{axis}


\end{tikzpicture}

% \begin{tikzpicture}[every plot/.append style={very thick}]
% \node[draw=none, fill=none] at (-1,5) {\Large C};
% \begin{axis}
%        [
%          name=figA,
%          axis line style = { draw = none },
%          width=1.2\linewidth,
%          height=0.6\linewidth,
%          xtick           = {0.5,1,1.5,2}         ,
%          ytick           = {-1.5,-1,-.5,0,.5,1,1.5}         ,
%          xmin=0.45,xmax=2.3,
%          tick pos        = left           ,
%          xlabel={$r$},
%          ylabel = {$x$},
%        ]




% \addplot [no markers, red] table [x index=0, y index=1, col sep=comma, mark=circle]{CSV/figure1_panel1_line1.csv};

% \addplot [no markers, blue] table [x index=0, y index=1, col sep=comma, mark=circle]{CSV/figure1_panel1_line2.csv};

% \addplot [no markers, red] table [x index=0, y index=1, col sep=comma, mark=circle]{CSV/figure1_panel1_line3.csv};

% \addplot [no markers, red] table [x index=0, y index=1, col sep=comma, mark=circle]{CSV/figure1_panel1_line4.csv};

% \addplot [no markers, blue] table [x index=0, y index=1, col sep=comma, mark=circle]{CSV/figure1_panel1_line5.csv};

% \addplot [no markers, blue] table [x index=0, y index=1, col sep=comma, mark=circle]{CSV/figure1_panel1_line6.csv};



% \addplot [
%     point meta=explicit,
%     scatter, only marks,
%     visualization depends on=\thisrowno{3}\as\metacolorind,
%     scatter/@pre marker code/.code={
%         \pgfplotsset{%
%         mark size=(1+0.003*\pgfplotspointmetatransformed)},%
%         \ifdim\metacolorind pt<0.1pt
%             \def\markopts{color=red}%
%         \else
%             \def\markopts{color=blue}%
%         \fi
%         \expandafter\scope\expandafter[\markopts]
%     },%
%     scatter/@post marker code/.code={%
%         \endscope
%     },%
%     ] table [x index=0, y index=1, meta index=2, col sep=comma]{CSV/figure2_panel3_line1.csv};

% \end{axis}

% \end{tikzpicture}
% \addplot [no markers, black, ultra thin] table [x index=0, y index=1, col sep=comma, mark=circle]{CSV/figure1_panel3_line2.csv};

% \end{axis}

% \end{tikzpicture}


% \hspace{-.6cm}
%     \begin{subfigure}[b]{0.6\linewidth}
%     \resizebox{\linewidth}{!}{

% \begin{tikzpicture}
% \node[draw=none, fill=none] at (0,6.6) {\Large C};
% \begin{axis}
%        [
%          axis line style = { draw = none },
%          %ymode=log,
%          xtick          = \empty,
%          %ytick           = {-10, 0, 10}         ,
%          ymin = -50,
%          ymax = 0 ,
%          tick pos        = left           ,
%          xlabel={},
%          %xticklabels    = {{Base}, {Diverging}},
%          ylabel = {$\log_{10}(L_0)$},
%        ]
       


% \def\cursf{a}

% \addplot +[only marks, color=black, mark=star] table [x index=0, y index=1, col sep=comma] {../CSV/figure_2\cursf_panel3.csv};
% \addplot +[only marks, color=red, mark=diamond, mark size=8] table [x index=0, y index=1, col sep=comma] {../CSV/figure_2\cursf_panel1.csv};
% %\addplot +[only marks, color=black, mark=diamond*, mark size=14] table [x index=0, y index=1, col sep=comma] {../CSV/figure_2\cursf_panel2.csv};

% \end{axis}

% \end{tikzpicture}
% }

% \end{subfigure}

% \hspace{.6cm}
% \captionsetup{width=1.15\linewidth}
% \caption{Bla bla.}
\end{figure}

\end{document}

